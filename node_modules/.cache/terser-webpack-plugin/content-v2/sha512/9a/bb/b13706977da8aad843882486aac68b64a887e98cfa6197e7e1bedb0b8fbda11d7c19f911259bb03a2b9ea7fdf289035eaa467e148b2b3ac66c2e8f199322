{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{494:function(s,a,t){\"use strict\";t.r(a);var e=t(50),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[t(\"h1\",{attrs:{id:\"fluid-给数据弹性一双隐形的翅膀-自定义弹性伸缩\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fluid-给数据弹性一双隐形的翅膀-自定义弹性伸缩\"}},[s._v(\"#\")]),s._v(\" Fluid 给数据弹性一双隐形的翅膀 -- 自定义弹性伸缩\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_jpg/yvBJb5IiafvlDU5Loo3wZD09D99qEvVsfnM1QfRV6eHamufkUACPTD6YjsVxtcN2EtJLo6tY2nI9odgMEm5HoGA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图片\"}})]),s._v(\" \"),t(\"p\",[t(\"strong\",[s._v(\"导读:\")]),s._v(\" 弹性伸缩作为 Kubernetes 的核心能力之一，但它一直是围绕这无状态的应用负载展开。而 Fluid 提供了分布式缓存的弹性伸缩能力，可以灵活扩充和收缩数据缓存。 它基于 Runtime 提供了缓存空间、现有缓存比例等性能指标, 结合自身对于 Runtime 资源的扩缩容能力，提供数据缓存按需伸缩能力。\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"背景\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#背景\"}},[s._v(\"#\")]),s._v(\" 背景\")]),s._v(\" \"),t(\"p\",[s._v(\"随着越来越多的大数据和 AI 等数据密集应用开始部署和运行在 Kubernetes 环境下，数据密集型应用计算框架的设计理念和云原生灵活的应用编排的分歧，导致了数据访问和计算瓶颈。云原生数据编排引擎 Fluid 通过数据集的抽象，利用分布式缓存技术，结合调度器，为应用提供了数据访问加速的能力。\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/yvBJb5IiafvlDU5Loo3wZD09D99qEvVsfDlDfPoLHK1CjzH8l4ibjQfKHOH5biazdrI7ZyemuhkNeSFqhiaYcUkt2A/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图片\"}})]),s._v(\" \"),t(\"p\",[s._v(\"弹性伸缩作为 Kubernetes 的核心能力之一，但它一直是围绕这无状态的应用负载展开。而 Fluid 提供了分布式缓存的弹性伸缩能力，可以灵活扩充和收缩数据缓存。它基于 Runtime 提供了缓存空间、现有缓存比例等性能指标, 结合自身对于 Runtime 资源的扩缩容能力，提供数据缓存按需伸缩能力。\")]),s._v(\" \"),t(\"p\",[s._v(\"这个能力对于互联网场景下大数据应用非常重要，由于多数的大数据应用都是通过端到端流水线来实现的。而这个流水线包含以下几个步骤：\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[t(\"strong\",[s._v(\"数据提取\")]),s._v(\"：利用 Spark，MapReduce 等大数据技术对于原始数据进行预处理。\")]),s._v(\" \"),t(\"li\",[t(\"strong\",[s._v(\"模型训练\")]),s._v(\"：利用第一阶段生成特征数据进行机器学习模型训练，并且生成相应的模型。\")]),s._v(\" \"),t(\"li\",[t(\"strong\",[s._v(\"模型评估\")]),s._v(\"：通过测试集或者验证集对于第二阶段生成模型进行评估和测试。\")]),s._v(\" \"),t(\"li\",[t(\"strong\",[s._v(\"模型推理\")]),s._v(\"：第三阶段验证后的模型最终推送到线上为业务提供推理服务。\")])]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/yvBJb5IiafvlDU5Loo3wZD09D99qEvVsfQY5EF2q2pwqTnjeXBsfEnvaDsZ6ubMeHb6PEI3Ln79xWUwHVBaz9pw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图片\"}})]),s._v(\" \"),t(\"p\",[s._v(\"可以看到端到端的流水线会包含多种不同类型的计算任务，针对每一个计算任务，实践中会有合适的专业系统来处理（TensorFlow，PyTorch，Spark， Presto）；但是这些系统彼此独立，通常要借助外部文件系统来实现把数据从一个阶段传递到下一个阶段。但是频繁的使用文件系统实现数据交换，会带来大量的 I/O 开销，经常会成为整个工作流的瓶颈。\")]),s._v(\" \"),t(\"p\",[s._v(\"而 Fluid 对于这个场景非常适合，用户可以创建一个 Dataset 对象，这个对象有能力将数据分散缓存到 Kubernetes 计算节点中，作为数据交换的介质，这样避免了数据的远程写入和读取，提升了数据使用的效率。但是这里的问题是临时数据缓存的资源预估和预留。由于在数据生产消费之前，精确的数据量预估是比较难满足，过高的预估会导致资源预留浪费，过低的预估会导致数据写入失败可能性增高。还是按需扩缩容对于使用者更加友好。我们希望能够达成类似 page cache 的使用效果，对于最终用户来说这一层是透明的但是它带来的缓存加速效果是实实在在的。\")]),s._v(\" \"),t(\"p\",[s._v(\"我们通过自定义 HPA 机制，通过 Fluid 引入了缓存弹性伸缩能力。弹性伸缩的条件是当已有缓存数据量达到一定比例时，就会触发弹性扩容，扩容缓存空间。例如将触发条件设置为缓存空间占比超过 75%，此时总的缓存空间为 10G，当数据已经占满 8G 缓存空间的时候，就会触发扩容机制。\")]),s._v(\" \"),t(\"p\",[s._v(\"下面我们通过一个例子帮助您体验 Fluid 的自动扩缩容能力。\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"前提条件\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#前提条件\"}},[s._v(\"#\")]),s._v(\" 前提条件\")]),s._v(\" \"),t(\"p\",[s._v(\"推荐使用 Kubernetes 1.18 以上，因为在 1.18 之前，HPA 是无法自定义扩缩容策略的，都是通过硬编码实现的。而在 1.18 后，用户可以自定义扩缩容策略的，比如可以定义一次扩容后的冷却时间。\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"具体步骤\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#具体步骤\"}},[s._v(\"#\")]),s._v(\" 具体步骤\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_1-安装-jq-工具方便解析-json\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-安装-jq-工具方便解析-json\"}},[s._v(\"#\")]),s._v(\" 1. 安装 jq 工具方便解析 json\")]),s._v(\" \"),t(\"p\",[s._v(\"在本例子中我们使用操作系统是 centos，可以通过 yum 安装 jq。\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"yum \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" -y jq\\n\")])])]),t(\"h3\",{attrs:{id:\"_2-下载、安装-fluid-最新版\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-下载、安装-fluid-最新版\"}},[s._v(\"#\")]),s._v(\" 2. 下载、安装 Fluid 最新版\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"git\")]),s._v(\" clone https://github.com/fluid-cloudnative/fluid.git\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" fluid/charts\\nkubectl create ns fluid-system\\nhelm \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" fluid fluid\\n\")])])]),t(\"h3\",{attrs:{id:\"_3-部署或配置-prometheus\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-部署或配置-prometheus\"}},[s._v(\"#\")]),s._v(\" 3. 部署或配置 Prometheus\")]),s._v(\" \"),t(\"p\",[s._v(\"这里通过 Prometheus 对于 AlluxioRuntime 的缓存引擎暴露的 Metrics 进行收集，如果集群内无 prometheus：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$ \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" fluid\\n$ kubectl apply -f integration/prometheus/prometheus.yaml\\n\")])])]),t(\"p\",[s._v(\"如集群内有 prometheus，可将以下配置写到 prometheus 配置文件中：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"scrape_configs\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"job_name\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'alluxio runtime'\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metrics_path\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" /metrics/prometheus\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kubernetes_sd_configs\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"role\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" endpoints\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"relabel_configs\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_service_label_monitor\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"regex\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" alluxio_runtime_metrics\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" keep\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_endpoint_port_name\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"regex\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" web\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" keep\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_namespace\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target_label\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" namespace\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replacement\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" $1\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" replace\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_service_label_release\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target_label\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" fluid_runtime\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replacement\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" $1\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" replace\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_endpoint_address_target_name\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target_label\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" pod\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replacement\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" $1\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" replace\\n\")])])]),t(\"h3\",{attrs:{id:\"_4-验证-prometheus-安装成功。\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-验证-prometheus-安装成功。\"}},[s._v(\"#\")]),s._v(\" \"),t(\"strong\",[s._v(\"4. 验证 Prometheus 安装成功。\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$ kubectl get ep -n kube-system  prometheus-svc\\nNAME             ENDPOINTS        AGE\\nprometheus-svc   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.76\")]),s._v(\".0.2:9090   6m49s\\n$ kubectl get svc -n kube-system prometheus-svc\\nNAME             TYPE       CLUSTER-IP      EXTERNAL-IP   PORT\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"S\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"          AGE\\nprometheus-svc   NodePort   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"172.16\")]),s._v(\".135.24   \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"        \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9090\")]),s._v(\":32114/TCP   2m7s\\n\")])])]),t(\"p\",[s._v(\"如果希望可视化监控指标，您可以安装 Grafana 验证监控数据，具体操作可以参考文档。\")]),s._v(\" \"),t(\"blockquote\",[t(\"p\",[s._v(\"文档地址：\")]),s._v(\" \"),t(\"p\",[s._v(\"https://github.com/fluid-cloudnative/fluid/blob/master/docs/zh/operation/monitoring.md\")])]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:\"https://mmbiz.qpic.cn/mmbiz_png/yvBJb5IiafvlDU5Loo3wZD09D99qEvVsftc0haAXmMLkBBagySeMURLh6Re8oT37J27Z1cr0hElvDia9wDWLqiaow/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\",alt:\"图片\"}})]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_5-部署-metrics-server\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_5-部署-metrics-server\"}},[s._v(\"#\")]),s._v(\" 5. 部署 metrics server\")]),s._v(\" \"),t(\"p\",[s._v(\"检查该集群是否包括 metrics-server，执行 \"),t(\"code\",[s._v(\"kubectl top node\")]),s._v(\" 有正确输出可以显示内存和 CPU，则该集群 metrics server 配置正确。\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"kubectl \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"top\")]),s._v(\" node\\nNAME                       CPU\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"cores\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   CPU%   MEMORY\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"bytes\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   MEMORY%\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".1.204   93m          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"%     1455Mi          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"%\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".1.205   125m         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"%     1925Mi          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"13\")]),s._v(\"%\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".1.206   96m          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"%     1689Mi          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"11\")]),s._v(\"%\\n\")])])]),t(\"p\",[s._v(\"否则手动执行以下命令：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"kubectl create -f integration/metrics-server\\n\")])])]),t(\"h3\",{attrs:{id:\"_6-部署-custom-metrics-api-组件。\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-部署-custom-metrics-api-组件。\"}},[s._v(\"#\")]),s._v(\" 6. 部署 custom-metrics-api 组件。\")]),s._v(\" \"),t(\"p\",[s._v(\"为了基于自定义指标进行扩展，你需要拥有两个组件：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"strong\",[s._v(\"第一个组件\")]),s._v(\"是从应用程序收集指标并将其存储到 Prometheus 时间序列数据库。\")]),s._v(\" \"),t(\"li\",[t(\"strong\",[s._v(\"第二个组件\")]),s._v(\"使用收集的度量指标来扩展 Kubernetes 自定义 metrics API，即 k8s-prometheus-adapter。\")])]),s._v(\" \"),t(\"p\",[s._v(\"第一个组件在第三步部署完成，下面部署第二个组件。\")]),s._v(\" \"),t(\"p\",[s._v(\"如果已经配置了custom-metrics-api，在 adapter 的 configmap 配置中增加与 dataset 相关的配置：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-yaml extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[t(\"code\",[s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" v1\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" ConfigMap\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metadata\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" adapter\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"config\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"namespace\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" monitoring\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"data\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"config.yaml\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"|\")]),t(\"span\",{pre:!0,attrs:{class:\"token scalar string\"}},[s._v(\"\\n   \\trules: \")]),s._v(\"\\n  \\t\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"seriesQuery\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\\'{__name__=~\"Cluster_(CapacityTotal|CapacityUsed)\",fluid_runtime!=\"\",instance!=\"\",job=\"alluxio runtime\",namespace!=\"\",pod!=\"\"}\\'')]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"seriesFilters\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"is\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" ^Cluster_(CapacityTotal\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"|\")]),s._v(\"CapacityUsed)$\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"resources\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"overrides\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"namespace\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"resource\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" namespace\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"pod\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"resource\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" pods\\n          \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"fluid_runtime\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n            \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"resource\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" datasets\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"matches\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"^(.*)\"')]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"as\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metricsQuery\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" ceil(Cluster_CapacityUsed\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"<<.LabelMatchers\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),t(\"span\",{pre:!0,attrs:{class:\"token important\"}},[s._v(\"*100/(Cluster_CapacityTotal\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"<<.LabelMatchers\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"))\\n\")])])]),t(\"p\",[s._v(\"否则手动执行以下命令：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"kubectl create -f integration/custom-metrics-api/namespace.yaml\\nkubectl create -f integration/custom-metrics-api\\n\")])])]),t(\"blockquote\",[t(\"p\",[s._v(\"注意：因为 custom-metrics-api 对接集群中的 Prometheous 的访问地址，请替换 prometheous url 为你真正使用的 Prometheous 地址。\")])]),s._v(\" \"),t(\"p\",[s._v(\"检查自定义指标：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"\\n$ kubectl get --raw \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/apis/custom.metrics.k8s.io/v1beta1\"')]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" jq\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"APIResourceList\"')]),s._v(\",\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"apiVersion\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v1\"')]),s._v(\",\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"groupVersion\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"custom.metrics.k8s.io/v1beta1\"')]),s._v(\",\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"resources\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pods/capacity_used_rate\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"singularName\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaced\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" true,\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"verbs\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"get\"')]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"datasets.data.fluid.io/capacity_used_rate\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"singularName\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaced\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" true,\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"verbs\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"get\"')]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaces/capacity_used_rate\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"singularName\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaced\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" false,\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"verbs\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"get\"')]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),t(\"h3\",{attrs:{id:\"_7-提交测试使用的-dataset\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_7-提交测试使用的-dataset\"}},[s._v(\"#\")]),s._v(\" 7. 提交测试使用的 Dataset\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$ cat\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<<\")]),s._v(\"EOF \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"dataset.yamlapiVersion: data.fluid.io/v1alpha1kind: Datasetmetadata:  name: sparkspec:  mounts:    - mountPoint: https://mirrors.bit.edu.cn/apache/spark/      name: spark---apiVersion: data.fluid.io/v1alpha1kind: AlluxioRuntimemetadata:  name: sparkspec:  replicas: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"  tieredstore:    levels:      - mediumtype: MEM        path: /dev/shm        quota: 1Gi        high: \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"0.99\"')]),s._v(\"        low: \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"0.7\"')]),s._v(\"  properties:    alluxio.user.streaming.data.timeout: 300secEOF$ kubectl create -f dataset.yamldataset.data.fluid.io/spark createdalluxioruntime.data.fluid.io/spark created\\n\")])])]),t(\"h3\",{attrs:{id:\"_8-查看这个-dataset-是否处于可用状态\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_8-查看这个-dataset-是否处于可用状态\"}},[s._v(\"#\")]),s._v(\" 8. 查看这个 Dataset 是否处于可用状态\")]),s._v(\" \"),t(\"p\",[s._v(\"可以看到该数据集的数据总量为 2.71GiB， 目前 Fluid 提供的缓存节点数为 1，可以提供的最大缓存能力为 1GiB。此时数据量是无法满足全量数据缓存的需求。\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"\\n$ kubectl get dataset\\nNAME    UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\\nspark   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".71GiB          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\".00B    \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\".00GiB          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\"%                Bound   7m38s\\n\\n\")])])]),t(\"h3\",{attrs:{id:\"_9-当该-dataset-处于可用状态后-查看是否已经可以从-custom-metrics-api-获得监控指标\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_9-当该-dataset-处于可用状态后-查看是否已经可以从-custom-metrics-api-获得监控指标\"}},[s._v(\"#\")]),s._v(\" 9. 当该 Dataset 处于可用状态后，查看是否已经可以从 custom-metrics-api 获得监控指标\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"kubectl get --raw \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/datasets.data.fluid.io/*/capacity_used_rate\"')]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" jq\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"apiVersion\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"custom.metrics.k8s.io/v1beta1\"')]),s._v(\",\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"metadata\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"selfLink\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/datasets.data.fluid.io/%2A/capacity_used_rate\"')]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"items\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"describedObject\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"Dataset\"')]),s._v(\",\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespace\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"default\"')]),s._v(\",\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"spark\"')]),s._v(\",\\n        \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"apiVersion\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"data.fluid.io/v1alpha1\"')]),s._v(\"\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"metricName\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"timestamp\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"2021-04-04T07:24:52Z\"')]),s._v(\",\\n      \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"value\"')]),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"0\"')]),s._v(\"\\n    \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),t(\"h3\",{attrs:{id:\"_10-创建-hpa-任务\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_10-创建-hpa-任务\"}},[s._v(\"#\")]),s._v(\" 10. 创建 HPA 任务\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"\\n$ cat\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<<\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"EOF\"),t(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" hpa.yaml\")]),s._v('\\napiVersion: autoscaling/v2beta2\\nkind: HorizontalPodAutoscaler\\nmetadata:\\n  name: spark\\nspec:\\n  scaleTargetRef:\\n    apiVersion: data.fluid.io/v1alpha1\\n    kind: AlluxioRuntime\\n    name: spark\\n  minReplicas: 1\\n  maxReplicas: 4\\n  metrics:\\n  - type: Object\\n    object:\\n      metric:\\n        name: capacity_used_rate\\n      describedObject:\\n        apiVersion: data.fluid.io/v1alpha1\\n        kind: Dataset\\n        name: spark\\n      target:\\n        type: Value\\n        value: \"90\"\\n  behavior:\\n    scaleUp:\\n      policies:\\n      - type: Pods\\n        value: 2\\n        periodSeconds: 600\\n    scaleDown:\\n      selectPolicy: Disabled\\nEOF')]),s._v(\"\\n\")])])]),t(\"p\",[s._v(\"首先，我们解读一下从样例配置，这里主要有两部分一个是扩缩容的规则，另一个是扩缩容的灵敏度：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[t(\"strong\",[s._v(\"规则\")]),s._v(\"：触发扩容行为的条件为 Dataset 对象的缓存数据量占总缓存能力的 90%；扩容对象为 \"),t(\"code\",[s._v(\"AlluxioRuntime\")]),s._v(\"，最小副本数为 1，最大副本数为 4；而 Dataset 和 AlluxioRuntime 的对象需要在同一个 namespace。\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[t(\"strong\",[s._v(\"策略\")]),s._v(\"：可以 K8s 1.18 以上的版本，可以分别针对扩容和缩容场景设置稳定时间和一次扩缩容步长比例。比如在本例子, 一次扩容周期为 10 分钟（periodSeconds），扩容时新增 2 个副本数，当然这也不可以超过 maxReplicas 的限制；而完成一次扩容后，冷却时间（stabilizationWindowSeconds）为 20 分钟；而缩容策略可以选择直接关闭。\")])])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_11-查看-hpa-配置-当前缓存空间的数据占比为-0。远远低于触发扩容的条件。\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_11-查看-hpa-配置-当前缓存空间的数据占比为-0。远远低于触发扩容的条件。\"}},[s._v(\"#\")]),s._v(\" 11. 查看 HPA 配置， 当前缓存空间的数据占比为 0。远远低于触发扩容的条件。\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"\\n$ kubectl get hpa\\nNAME    REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nspark   AlluxioRuntime/spark   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"/90      \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"          33s\\n$ kubectl describe hpa\\nName:                                                    spark\\nNamespace:                                               default\\nLabels:                                                  \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nAnnotations:                                             \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nCreationTimestamp:                                       Wed, 07 Apr \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"17\")]),s._v(\":36:39 +0800\\nReference:                                               AlluxioRuntime/spark\\nMetrics:                                                 \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" current / target \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\" on Dataset/spark \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"target value\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\":  \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" / \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"90\")]),s._v(\"\\nMin replicas:                                            \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nMax replicas:                                            \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\nBehavior:\\n  Scale Up:\\n    Stabilization Window: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" seconds\\n    Select Policy: Max\\n    Policies:\\n      - Type: Pods  Value: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"  Period: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"600\")]),s._v(\" seconds\\n  Scale Down:\\n    Select Policy: Disabled\\n    Policies:\\n      - Type: Percent  Value: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\"  Period: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15\")]),s._v(\" seconds\\nAlluxioRuntime pods:   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" current / \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" desired\\nConditions:\\n  Type            Status  Reason               Message\\n  ----            ------  ------               -------\\n  AbleToScale     True    ScaleDownStabilized  recent recommendations were higher than current one, applying the highest recent recommendation\\n  ScalingActive   True    ValidMetricFound     the HPA was able to successfully calculate a replica count from Dataset metric capacity_used_rate\\n  ScalingLimited  False   DesiredWithinRange   the desired count is within the acceptable range\\nEvents:           \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\")])])]),t(\"h3\",{attrs:{id:\"_12-创建数据预热任务\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_12-创建数据预热任务\"}},[s._v(\"#\")]),s._v(\" 12. 创建数据预热任务\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$ cat\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<<\")]),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"EOF\"),t(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" dataload.yaml\")]),s._v(\"\\napiVersion: data.fluid.io/v1alpha1\\nkind: DataLoad\\nmetadata:\\n  name: spark\\nspec:\\n  dataset:\\n    name: spark\\n    namespace: default\\nEOF\")]),s._v(\"\\n$ kubectl create -f dataload.yaml\\n$ kubectl get dataload\\nNAME    DATASET   PHASE       AGE   DURATION\\nspark   spark     Executing   15s   Unfinished\\n\")])])]),t(\"h3\",{attrs:{id:\"_13-此时可以发现缓存的数据量接近了-fluid-可以提供的缓存能力-1gib-同时触发了弹性伸缩的条件\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_13-此时可以发现缓存的数据量接近了-fluid-可以提供的缓存能力-1gib-同时触发了弹性伸缩的条件\"}},[s._v(\"#\")]),s._v(\" 13. 此时可以发现缓存的数据量接近了 Fluid 可以提供的缓存能力（1GiB）同时触发了弹性伸缩的条件\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$  kubectl  get dataset\\nNAME    UFS TOTAL SIZE   CACHED       CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\\nspark   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".71GiB          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1020\")]),s._v(\".92MiB   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\".00GiB          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"36.8\")]),s._v(\"%               Bound   5m15s\\n\")])])]),t(\"p\",[s._v(\"从 HPA 的监控，可以看到 Alluxio Runtime 的扩容已经开始, 可以发现扩容的步长为 2。\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"\\n$ kubectl get hpa\\nNAME    REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nspark   AlluxioRuntime/spark   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\"/90    \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"          4m20s\\n$ kubectl describe hpa\\nName:                                                    spark\\nNamespace:                                               default\\nLabels:                                                  \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nAnnotations:                                             \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nCreationTimestamp:                                       Wed, 07 Apr \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"17\")]),s._v(\":56:31 +0800\\nReference:                                               AlluxioRuntime/spark\\nMetrics:                                                 \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" current / target \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\" on Dataset/spark \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"target value\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\":  \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\" / \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"90\")]),s._v(\"\\nMin replicas:                                            \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nMax replicas:                                            \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\nBehavior:\\n  Scale Up:\\n    Stabilization Window: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" seconds\\n    Select Policy: Max\\n    Policies:\\n      - Type: Pods  Value: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"  Period: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"600\")]),s._v(\" seconds\\n  Scale Down:\\n    Select Policy: Disabled\\n    Policies:\\n      - Type: Percent  Value: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\"  Period: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15\")]),s._v(\" seconds\\nAlluxioRuntime pods:   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\" current / \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\" desired\\nConditions:\\n  Type            Status  Reason              Message\\n  ----            ------  ------              -------\\n  AbleToScale     True    SucceededRescale    the HPA controller was able to update the target scale to \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"\\n  ScalingActive   True    ValidMetricFound    the HPA was able to successfully calculate a replica count from Dataset metric capacity_used_rate\\n  ScalingLimited  False   DesiredWithinRange  the desired count is within the acceptable range\\nEvents:\\n  Type     Reason                        Age                    From                       Message\\n  ----     ------                        ----                   ----                       -------\\n  Normal   SuccessfulRescale             21s                    horizontal-pod-autoscaler  New size: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" reason: Dataset metric capacity_used_rate above target\\n  Normal   SuccessfulRescale             6s                     horizontal-pod-autoscaler  New size: \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" reason: Dataset metric capacity_used_rate above target\\n\")])])]),t(\"h3\",{attrs:{id:\"_14-在等待一段时间之后发现数据集的缓存空间由-1gib-提升到了-3gib-数据缓存已经接近完成\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_14-在等待一段时间之后发现数据集的缓存空间由-1gib-提升到了-3gib-数据缓存已经接近完成\"}},[s._v(\"#\")]),s._v(\" 14. 在等待一段时间之后发现数据集的缓存空间由 1GiB 提升到了 3GiB，数据缓存已经接近完成\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$ kubectl  get dataset\\nNAME    UFS TOTAL SIZE   CACHED    CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\\nspark   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".71GiB          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".59GiB   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\".00GiB          \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"95.6\")]),s._v(\"%               Bound   12m\\n\")])])]),t(\"p\",[s._v(\"同时观察 HPA 的状态，可以发现此时 Dataset 对应的 runtime 的 replicas 数量为 3， 已经使用的缓存空间比例 capacity_used_rate 为 85%，已经不会触发缓存扩容。\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"$ kubectl get hpa\\nNAME    REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nspark   AlluxioRuntime/spark   \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"85\")]),s._v(\"/90     \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"         \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"          11m\\n\")])])]),t(\"h3\",{attrs:{id:\"_15-清理环境\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_15-清理环境\"}},[s._v(\"#\")]),s._v(\" 15. 清理环境\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-bash extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[t(\"code\",[s._v(\"skubectl delete hpa spark\\nkubectl delete dataset spark\\n\")])])]),t(\"h2\",{attrs:{id:\"总结\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#总结\"}},[s._v(\"#\")]),s._v(\" 总结\")]),s._v(\" \"),t(\"p\",[s._v(\"Fluid 提供了结合 Prometheous，Kubernetes HPA 和 Custom Metrics 能力，根据占用缓存空间的比例触发自动弹性伸缩的能力，实现缓存能力的按需使用。这样能够帮助用户更加灵活的使用通过分布式缓存提升数据访问加速能力，后续我们会提供定时扩缩的能力，为扩缩容提供更强的确定性。\")]),s._v(\" \"),t(\"p\",[s._v(\"Fluid 的代码仓库：https://github.com/fluid-cloudnative/fluid.git， 欢迎大家关注、贡献代码和 star。\")])])}),[],!1,null,null,null);a.default=n.exports}}]);","extractedComments":[]}