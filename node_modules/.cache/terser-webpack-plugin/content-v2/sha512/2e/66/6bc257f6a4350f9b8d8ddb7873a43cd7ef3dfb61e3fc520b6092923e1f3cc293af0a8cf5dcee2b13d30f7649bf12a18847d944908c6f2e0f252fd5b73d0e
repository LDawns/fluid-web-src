{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{505:function(s,t,a){\"use strict\";a.r(t);var e=a(50),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"示例-dataset-自定义弹性扩缩容\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#示例-dataset-自定义弹性扩缩容\"}},[s._v(\"#\")]),s._v(\" 示例 - Dataset 自定义弹性扩缩容\")]),s._v(\" \"),a(\"p\",[s._v(\"Fluid 可以通过创建 Dataset 对象将数据分散到 Kubernetes 计算节点中，作为数据交换的介质，可以有效避免了数据的远程写入和读取，提升了数据使用的效率。\\n但是这里的问题是数据缓存的资源预估和预留。由于在数据生产消费之前，精准的数据预估是比较难以满足的，使用按需扩缩容对于使用者更加友好。\\n按需扩缩容技术类似于 page cache，对于用户而言这一层是透明的但是它带来的加速效果是很明显的。\")]),s._v(\" \"),a(\"p\",[s._v(\"通过自定义 HPA 机制，使得 Fluid 引入了缓存弹性伸缩能力。弹性伸缩的条件就是当已有缓存数据量达到一定比例时就会发生弹性扩容缓存空间。例如\\n触发条件设置为占比超过 80%，总的缓存空间为 10G,当数据占满到 8G 缓存空间时，就会触发扩缩容。\")]),s._v(\" \"),a(\"p\",[s._v(\"本文将向你展示这一特性。\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"前提条件\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#前提条件\"}},[s._v(\"#\")]),s._v(\" 前提条件\")]),s._v(\" \"),a(\"p\",[s._v(\"推荐使用 Kubernetes 1.18 以上，因为在 1.18 之前，HPA 是无法自定义扩缩容策略的，都是通过硬编码实现的。而在 1.18 后，用户可以自定义扩缩容策略的，比如可以定义一次扩容后的冷却时间。\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"具体步骤\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#具体步骤\"}},[s._v(\"#\")]),s._v(\" 具体步骤\")]),s._v(\" \"),a(\"ol\",[a(\"li\",[s._v(\"安装 jq 工具方便解析 json，在本例子中我们使用操作系统是 Centos，可以通过 yum 安装 jq\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ yum \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" -y jq\\n\")])])]),a(\"ol\",{attrs:{start:\"2\"}},[a(\"li\",[s._v(\"下载、安装 Fluid 最新版\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"git\")]),s._v(\" clone https://github.com/fluid-cloudnative/fluid.git\\n$ \"),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" fluid/charts\\n$ kubectl create ns fluid-system\\n$ helm \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" fluid fluid\\n\")])])]),a(\"ol\",{attrs:{start:\"3\"}},[a(\"li\",[s._v(\"部署或配置 Prometheus\")])]),s._v(\" \"),a(\"p\",[s._v(\"这里通过 Prometheus 对于 AlluxioRuntime 的缓存引擎暴露的 Metrics 进行收集，如果集群内无 Prometheus:\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ \"),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" fluid\\n$ kubectl apply -f integration/prometheus/prometheus.yaml\\n\")])])]),a(\"p\",[s._v(\"如集群内有 Prometheus,可将以下配置写到 Prometheus 配置文件中:\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-yaml extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"scrape_configs\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"job_name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'alluxio runtime'\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metrics_path\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" /metrics/prometheus\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kubernetes_sd_configs\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"role\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" endpoints\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"relabel_configs\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_service_label_monitor\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"regex\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" alluxio_runtime_metrics\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" keep\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_endpoint_port_name\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"regex\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" web\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" keep\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_namespace\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target_label\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" namespace\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replacement\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" $1\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" replace\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_service_label_release\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target_label\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" fluid_runtime\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replacement\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" $1\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" replace\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"source_labels\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"__meta_kubernetes_endpoint_address_target_name\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target_label\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" pod\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replacement\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" $1\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"action\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" replace\\n\")])])]),a(\"ol\",{attrs:{start:\"4\"}},[a(\"li\",[s._v(\"验证 Prometheus 安装成功\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get ep -n kube-system  prometheus-svc\\nNAME             ENDPOINTS        AGE\\nprometheus-svc   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.76\")]),s._v(\".0.2:9090   6m49s\\n$ kubectl get svc -n kube-system prometheus-svc\\nNAME             TYPE       CLUSTER-IP      EXTERNAL-IP   PORT\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"S\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"          AGE\\nprometheus-svc   NodePort   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"172.16\")]),s._v(\".135.24   \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"        \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9090\")]),s._v(\":32114/TCP   2m7s\\n\")])])]),a(\"p\",[s._v(\"如果希望可视化监控指标，您可以安装 Grafana 验证监控数据，具体操作可以参考\"),a(\"RouterLink\",{attrs:{to:\"/zh/operation/monitoring.html\"}},[s._v(\"文档\")])],1),s._v(\" \"),a(\"ol\",{attrs:{start:\"5\"}},[a(\"li\",[s._v(\"部署 metrics server\")])]),s._v(\" \"),a(\"p\",[s._v(\"检查该集群是否包括 metrics-server, 执行 kubectl top node 有正确输出可以显示内存和 CPU，则该集群 metrics server 配置正确\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"top\")]),s._v(\" node\\nNAME                       CPU\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"cores\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   CPU%   MEMORY\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"bytes\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   MEMORY%\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".1.204   93m          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"%     1455Mi          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\"%\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".1.205   125m         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"%     1925Mi          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"13\")]),s._v(\"%\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".1.206   96m          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"%     1689Mi          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"11\")]),s._v(\"%\\n\")])])]),a(\"p\",[s._v(\"否则手动执行以下命令\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl create -f integration/metrics-server\\n\")])])]),a(\"ol\",{attrs:{start:\"6\"}},[a(\"li\",[s._v(\"部署 custom-metrics-api 组件\")])]),s._v(\" \"),a(\"p\",[s._v(\"为了基于自定义指标进行扩展，你需要拥有两个组件。第一个组件是从应用程序收集指标并将其存储到 Prometheus 时间序列数据库。第二个组件使用收集的度量指标来扩展 Kubernetes 自定义 metrics API，即 k8s-prometheus-adapter。第一个组件在第三步部署完成，下面部署第二个组件：\")]),s._v(\" \"),a(\"p\",[s._v(\"如果已经配置了 custom-metrics-api，在 adapter 的 configmap 配置中增加与 dataset 相关的配置\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-yaml extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" v1\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" ConfigMap\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metadata\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" adapter\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"config\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"namespace\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" monitoring\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"data\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"config.yaml\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"|\")]),a(\"span\",{pre:!0,attrs:{class:\"token scalar string\"}},[s._v('\\n    rules:\\n    - seriesQuery: \\'{__name__=~\"Cluster_(CapacityTotal|CapacityUsed)\",fluid_runtime!=\"\",instance!=\"\",job=\"alluxio runtime\",namespace!=\"\",pod!=\"\"}\\'\\n      seriesFilters:\\n      - is: ^Cluster_(CapacityTotal|CapacityUsed)$\\n      resources:\\n        overrides:\\n          namespace:\\n            resource: namespace\\n          pod:\\n            resource: pods\\n          fluid_runtime:\\n            resource: datasets\\n      name:\\n        matches: \"^(.*)\"\\n        as: \"capacity_used_rate\"\\n      metricsQuery: ceil(Cluster_CapacityUsed{<<.LabelMatchers>>}*100/(Cluster_CapacityTotal{<<.LabelMatchers>>}))')]),s._v(\"\\n\")])])]),a(\"p\",[s._v(\"否则手动执行以下命令\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl create -f integration/custom-metrics-api/namespace.yaml\\n$ kubectl create -f integration/custom-metrics-api\\n\")])])]),a(\"blockquote\",[a(\"p\",[s._v(\"注意：因为 custom-metrics-api 对接集群中的 Prometheous 的访问地址，请替换 Prometheous url 为你真正使用的 Prometheous 地址。\")])]),s._v(\" \"),a(\"p\",[s._v(\"检查自定义指标\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get --raw \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/apis/custom.metrics.k8s.io/v1beta1\"')]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" jq\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"APIResourceList\"')]),s._v(\",\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"apiVersion\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"v1\"')]),s._v(\",\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"groupVersion\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"custom.metrics.k8s.io/v1beta1\"')]),s._v(\",\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"resources\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"pods/capacity_used_rate\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"singularName\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaced\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" true,\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"verbs\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"get\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"datasets.data.fluid.io/capacity_used_rate\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"singularName\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaced\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" true,\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"verbs\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"get\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaces/capacity_used_rate\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"singularName\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespaced\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" false,\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"verbs\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"get\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),a(\"ol\",{attrs:{start:\"7\"}},[a(\"li\",[s._v(\"提交测试使用的 Dataset\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-yaml extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[a(\"code\",[s._v(\"$ cat<<EOF \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),s._v(\"dataset.yaml\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" data.fluid.io/v1alpha1\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Dataset\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metadata\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spec\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"mounts\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"mountPoint\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" https\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"//mirrors.bit.edu.cn/apache/spark/\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"---\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" data.fluid.io/v1alpha1\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" AlluxioRuntime\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metadata\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spec\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"replicas\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"tieredstore\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"levels\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"mediumtype\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" MEM\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"path\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" /dev/shm\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"quota\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" 1Gi\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"high\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"0.99\"')]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"low\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"0.7\"')]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"properties\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"alluxio.user.streaming.data.timeout\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" 300sec\\nEOF\\n$ kubectl create \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"f dataset.yaml\\ndataset.data.fluid.io/spark created\\nalluxioruntime.data.fluid.io/spark created\\n\")])])]),a(\"ol\",{attrs:{start:\"8\"}},[a(\"li\",[s._v(\"查看这个 Dataset 是否处于可用状态, 可以看到该数据集的数据总量为 2.71GiB，目前 Fluid 提供的缓存节点数为 1，可以提供的最大缓存能力为 1GiB。此时数据量是无法满足全量数据缓存的需求。\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get dataset\\nNAME    UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\\nspark   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".71GiB          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\".00B    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\".00GiB          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\"%                Bound   7m38s\\n\")])])]),a(\"ol\",{attrs:{start:\"9\"}},[a(\"li\",[s._v(\"当该 Dataset 处于可用状态后，查看是否已经可以从 custom-metrics-api 获得监控指标\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get --raw \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/datasets.data.fluid.io/*/capacity_used_rate\"')]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" jq\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"MetricValueList\"')]),s._v(\",\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"apiVersion\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"custom.metrics.k8s.io/v1beta1\"')]),s._v(\",\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"metadata\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"selfLink\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/datasets.data.fluid.io/%2A/capacity_used_rate\"')]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"items\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"describedObject\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"kind\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"Dataset\"')]),s._v(\",\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"namespace\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"default\"')]),s._v(\",\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"name\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"spark\"')]),s._v(\",\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"apiVersion\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"data.fluid.io/v1alpha1\"')]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"metricName\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"timestamp\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"2021-04-04T07:24:52Z\"')]),s._v(\",\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"value\"')]),a(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"0\"')]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),a(\"ol\",{attrs:{start:\"10\"}},[a(\"li\",[s._v(\"创建 HPA 任务\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-yaml extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[a(\"code\",[s._v(\"$ cat<<EOF \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),s._v(\" hpa.yaml\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" autoscaling/v2beta2\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" HorizontalPodAutoscaler\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metadata\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spec\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"scaleTargetRef\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" data.fluid.io/v1alpha1\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" AlluxioRuntime\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"minReplicas\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"maxReplicas\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metrics\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"type\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Object\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"object\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metric\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" capacity_used_rate\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"describedObject\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" data.fluid.io/v1alpha1\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Dataset\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"target\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"type\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Value\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"value\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"90\"')]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"behavior\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"scaleUp\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"policies\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"type\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Pods\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"value\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"periodSeconds\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"600\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"scaleDown\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"selectPolicy\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" Disabled\\nEOF\\n\")])])]),a(\"p\",[s._v(\"首先，我们解读一下从样例配置，这里主要有两部分一个是扩缩容的规则，另一个是扩缩容的灵敏度：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"规则：触发扩容行为的条件为 Dataset 对象的缓存数据量占总缓存能力的 90%; 扩容对象为 AlluxioRuntime, 最小副本数为 1，最大副本数为 4; 而 Dataset 和 AlluxioRuntime 的对象需要在同一个 namespace。\")]),s._v(\" \"),a(\"li\",[s._v(\"策略： 可以 K8s 1.18 以上的版本，可以分别针对扩容和缩容场景设置稳定时间和一次扩缩容步长比例。比如在本例子, 一次扩容周期为 10 分钟(periodSeconds),扩容时新增 2 个副本数，当然这也不可以超过 maxReplicas 的限制；而完成一次扩容后, 冷却时间(stabilizationWindowSeconds)为 20 分钟; 而缩容策略可以选择直接关闭。\")])]),s._v(\" \"),a(\"ol\",{attrs:{start:\"11\"}},[a(\"li\",[s._v(\"查看 HPA 配置，当前缓存空间的数据占比为 0。远远低于触发扩容的条件\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get hpa\\nNAME    REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nspark   AlluxioRuntime/spark   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"/90      \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"          33s\\n$ kubectl describe hpa\\nName:                                                    spark\\nNamespace:                                               default\\nLabels:                                                  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nAnnotations:                                             \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nCreationTimestamp:                                       Wed, 07 Apr \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"17\")]),s._v(\":36:39 +0800\\nReference:                                               AlluxioRuntime/spark\\nMetrics:                                                 \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" current / target \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\" on Dataset/spark \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"target value\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\":  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" / \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"90\")]),s._v(\"\\nMin replicas:                                            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nMax replicas:                                            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\nBehavior:\\n  Scale Up:\\n    Stabilization Window: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" seconds\\n    Select Policy: Max\\n    Policies:\\n      - Type: Pods  Value: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"  Period: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"600\")]),s._v(\" seconds\\n  Scale Down:\\n    Select Policy: Disabled\\n    Policies:\\n      - Type: Percent  Value: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\"  Period: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15\")]),s._v(\" seconds\\nAlluxioRuntime pods:   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" current / \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" desired\\nConditions:\\n  Type            Status  Reason               Message\\n  ----            ------  ------               -------\\n  AbleToScale     True    ScaleDownStabilized  recent recommendations were higher than current one, applying the highest recent recommendation\\n  ScalingActive   True    ValidMetricFound     the HPA was able to successfully calculate a replica count from Dataset metric capacity_used_rate\\n  ScalingLimited  False   DesiredWithinRange   the desired count is within the acceptable range\\nEvents:           \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\")])])]),a(\"ol\",{attrs:{start:\"12\"}},[a(\"li\",[s._v(\"创建数据预热任务\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-yaml extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[a(\"code\",[s._v(\"$ cat<<EOF \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\">\")]),s._v(\" dataload.yaml\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"apiVersion\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" data.fluid.io/v1alpha1\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"kind\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" DataLoad\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"metadata\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"spec\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"dataset\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"name\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" spark\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"namespace\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" default\\nEOF\\n$ kubectl create \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"-\")]),s._v(\"f dataload.yaml\\n$ kubectl get dataload\\nNAME    DATASET   PHASE       AGE   DURATION\\nspark   spark     Executing   15s   Unfinished\\n\")])])]),a(\"ol\",{attrs:{start:\"13\"}},[a(\"li\",[s._v(\"此时可以发现缓存的数据量接近了 Fluid 可以提供的缓存能力（1GiB）同时触发了弹性伸缩的条件\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$  kubectl  get dataset\\nNAME    UFS TOTAL SIZE   CACHED       CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\\nspark   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".71GiB          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1020\")]),s._v(\".92MiB   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\".00GiB          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"36.8\")]),s._v(\"%               Bound   5m15s\\n\")])])]),a(\"p\",[s._v(\"从 HPA 的监控，可以看到 Alluxio Runtime 的扩容已经开始, 可以发现扩容的步长为 2\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get hpa\\nNAME    REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nspark   AlluxioRuntime/spark   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\"/90    \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"          4m20s\\n$ kubectl describe hpa\\nName:                                                    spark\\nNamespace:                                               default\\nLabels:                                                  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nAnnotations:                                             \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"none\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\nCreationTimestamp:                                       Wed, 07 Apr \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2021\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"17\")]),s._v(\":56:31 +0800\\nReference:                                               AlluxioRuntime/spark\\nMetrics:                                                 \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\" current / target \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"capacity_used_rate\"')]),s._v(\" on Dataset/spark \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"target value\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\":  \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\" / \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"90\")]),s._v(\"\\nMin replicas:                                            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nMax replicas:                                            \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\nBehavior:\\n  Scale Up:\\n    Stabilization Window: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" seconds\\n    Select Policy: Max\\n    Policies:\\n      - Type: Pods  Value: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"  Period: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"600\")]),s._v(\" seconds\\n  Scale Down:\\n    Select Policy: Disabled\\n    Policies:\\n      - Type: Percent  Value: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"100\")]),s._v(\"  Period: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15\")]),s._v(\" seconds\\nAlluxioRuntime pods:   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\" current / \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\" desired\\nConditions:\\n  Type            Status  Reason              Message\\n  ----            ------  ------              -------\\n  AbleToScale     True    SucceededRescale    the HPA controller was able to update the target scale to \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"\\n  ScalingActive   True    ValidMetricFound    the HPA was able to successfully calculate a replica count from Dataset metric capacity_used_rate\\n  ScalingLimited  False   DesiredWithinRange  the desired count is within the acceptable range\\nEvents:\\n  Type     Reason                        Age                    From                       Message\\n  ----     ------                        ----                   ----                       -------\\n  Normal   SuccessfulRescale             21s                    horizontal-pod-autoscaler  New size: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" reason: Dataset metric capacity_used_rate above target\\n  Normal   SuccessfulRescale             6s                     horizontal-pod-autoscaler  New size: \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" reason: Dataset metric capacity_used_rate above target\\n\")])])]),a(\"ol\",{attrs:{start:\"14\"}},[a(\"li\",[s._v(\"在等待一段时间之后发现数据集的缓存空间由 1GiB 提升到了 3GiB，数据缓存已经接近完成\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl  get dataset\\nNAME    UFS TOTAL SIZE   CACHED    CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\\nspark   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".71GiB          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\".59GiB   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\".00GiB          \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"95.6\")]),s._v(\"%               Bound   12m\\n\")])])]),a(\"ol\",{attrs:{start:\"15\"}},[a(\"li\",[s._v(\"观察 HPA 的状态，可以发现此时 Dataset 对应的 runtime 的 replicas 数量为 3， 已经使用的缓存空间比例 capacity_used_rate 为 85%，已经不会触发缓存扩容。\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl get hpa\\nNAME    REFERENCE              TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nspark   AlluxioRuntime/spark   \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"85\")]),s._v(\"/90     \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"         \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3\")]),s._v(\"          11m\\n\")])])]),a(\"ol\",{attrs:{start:\"16\"}},[a(\"li\",[s._v(\"清理环境\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language-shell extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[a(\"code\",[s._v(\"$ kubectl delete hpa spark\\n$ kubectl delete dataset spark\\n\")])])]),a(\"h2\",{attrs:{id:\"总结\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#总结\"}},[s._v(\"#\")]),s._v(\" 总结\")]),s._v(\" \"),a(\"p\",[s._v(\"Fluid提供了结合 Prometheous，Kubernetes HPA 和 Custom Metrics 能力，根据占用缓存空间的比例触发自动弹性伸缩的能力，实现缓存能力的按需使用。这样能够帮助用户更加灵活的使用通过分布式缓存提升数据访问加速能力，后续我们会提供定时扩缩的能力，为扩缩容提供更强的确定性。\")])])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}