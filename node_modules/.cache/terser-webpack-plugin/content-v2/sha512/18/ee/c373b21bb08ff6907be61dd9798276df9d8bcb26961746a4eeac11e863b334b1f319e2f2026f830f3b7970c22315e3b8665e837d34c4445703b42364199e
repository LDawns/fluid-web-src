{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{509:function(a,t,s){\"use strict\";s.r(t);var n=s(50),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":a.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"示例-pod-调度优化\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#示例-pod-调度优化\"}},[a._v(\"#\")]),a._v(\" 示例 - Pod 调度优化\")]),a._v(\" \"),s(\"p\",[a._v(\"为了帮助用户更好的使用fluid，我们提供了一系列调度插件。\\n通过为Pod自动注入亲和性相关信息，优化Pod的调度结果，提高集群的整体使用效率。\")]),a._v(\" \"),s(\"h2\",{attrs:{id:\"前提条件\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#前提条件\"}},[a._v(\"#\")]),a._v(\" 前提条件\")]),a._v(\" \"),s(\"p\",[a._v(\"您使用的k8s版本需要支持 admissionregistration.k8s.io/v1beta1（ Kubernetes version > 1.14 )\")]),a._v(\" \"),s(\"h2\",{attrs:{id:\"使用方法\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#使用方法\"}},[a._v(\"#\")]),a._v(\" 使用方法\")]),a._v(\" \"),s(\"p\",[s(\"strong\",[a._v(\"查看全部节点\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ kubectl get no\\nNAME                      STATUS   ROLES    AGE   VERSION\\nnode.172.16.0.16   Ready    \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"   13d   v1.20.4\\nnode.172.16.1.84   Ready    \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"   13d   v1.20.4\\n\")])])]),s(\"p\",[s(\"strong\",[a._v(\"检查待创建的Dataset资源对象\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ cat\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<<\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v(\"EOF\"),s(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"dataset.yaml\")]),a._v('\\napiVersion: data.fluid.io/v1alpha1\\nkind: Dataset\\nmetadata:\\n  name: hbase\\nspec:\\n  mounts:\\n    - mountPoint: https://mirrors.tuna.tsinghua.edu.cn/apache/hbase/stable/\\n      name: hbase\\n---\\napiVersion: data.fluid.io/v1alpha1\\nkind: AlluxioRuntime\\nmetadata:\\n  name: hbase\\nspec:\\n  replicas: 1\\n  tieredstore:\\n    levels:\\n      - mediumtype: MEM\\n        path: /dev/shm\\n        quota: 2Gi\\n        high: \"0.95\"\\n        low: \"0.7\"\\nEOF')]),a._v(\"\\n\")])])]),s(\"p\",[s(\"strong\",[a._v(\"创建Dataset资源对象\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ kubectl create -f dataset.yaml\\ndataset.data.fluid.io/hbase created\\n\")])])]),s(\"p\",[s(\"strong\",[a._v(\"创建AlluxioRuntime资源并查看状态\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ kubectl create -f runtime.yaml\\nalluxioruntime.data.fluid.io/hbase created\\n\\n$ kubectl get po -owide\\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE                      NOMINATED NODE   READINESS GATES\\nhbase-fuse-fdjpg     \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1\")]),a._v(\"/1     Running   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"0\")]),a._v(\"          94m   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"172.16\")]),a._v(\".0.16   node.172.16.0.16   \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"           \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"\\nhbase-master-0       \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"2\")]),a._v(\"/2     Running   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"0\")]),a._v(\"          97m   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"172.16\")]),a._v(\".0.16   node.172.16.0.16   \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"           \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"\\nhbase-worker-ch8k7   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"2\")]),a._v(\"/2     Running   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"0\")]),a._v(\"          94m   \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"172.16\")]),a._v(\".0.16   node.172.16.0.16   \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"           \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<\")]),a._v(\"none\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"在此处可以看到，有一个Alluxio Worker成功启动，并且运行在节点172.16.0.16上。Alluixo Fuse的数量为1，也运行在节点172.16.0.16上。\")]),a._v(\" \"),s(\"h2\",{attrs:{id:\"运行示例1-创建没有挂载数据集的pod-它将尽量远离部署有数据集的节点\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#运行示例1-创建没有挂载数据集的pod-它将尽量远离部署有数据集的节点\"}},[a._v(\"#\")]),a._v(\" 运行示例1: 创建没有挂载数据集的Pod，它将尽量远离部署有数据集的节点\")]),a._v(\" \"),s(\"p\",[s(\"strong\",[a._v(\"创建Pod\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ cat\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<<\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v(\"EOF\"),s(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"nginx.yaml\")]),a._v(\"\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: nginx\\nspec:\\n  containers:\\n    - name: nginx\\n      image: nginx\\nEOF\")]),a._v(\"\\n$ kubectl create -f nginx.yaml\\n\")])])]),s(\"p\",[s(\"strong\",[a._v(\"查看Pod\")])]),a._v(\" \"),s(\"p\",[a._v(\"查看Pod的yaml文件，发现被注入了如下信息：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"spec\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"affinity\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"nodeAffinity\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"preferredDuringSchedulingIgnoredDuringExecution\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"preference\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n            \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"matchExpressions\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n              \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"key\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\" fluid.io/dataset\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\"num\\n                \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"operator\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\" DoesNotExist\\n          \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"weight\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"100\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"正如亲和性所影响的，Pod调度到了没有缓存的node.172.16.1.84节点。\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ kubectl get pods nginx -o  custom-columns\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"NAME:metadata.name,NODE:.spec.nodeName\\nNAME    NODE\\nnginx   node.172.16.1.84\\n\")])])]),s(\"h2\",{attrs:{id:\"运行示例2-创建挂载数据集的pod-可以观测到它被调度到有数据集的节点\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#运行示例2-创建挂载数据集的pod-可以观测到它被调度到有数据集的节点\"}},[a._v(\"#\")]),a._v(\" 运行示例2: 创建挂载数据集的Pod，可以观测到它被调度到有数据集的节点\")]),a._v(\" \"),s(\"p\",[s(\"strong\",[a._v(\"创建Pod\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ cat\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<<\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v(\"EOF\"),s(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\"nginx.yaml\")]),a._v(\"\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: nginx\\nspec:\\n  containers:\\n    - name: nginx\\n      image: nginx\\n      volumeMounts:\\n        - mountPath: /data\\n          name: hbase-vol\\n  volumes:\\n    - name: hbase-vol\\n      persistentVolumeClaim:\\n        claimName: hbase\\nEOF\")]),a._v(\"\\n$ kubectl create -f nginx.yaml\\n\")])])]),s(\"p\",[s(\"strong\",[a._v(\"查看Pod\")])]),a._v(\" \"),s(\"p\",[a._v(\"查看Pod的yaml文件，发现被注入了如下信息：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"spec\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"affinity\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"nodeAffinity\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"requiredDuringSchedulingIgnoredDuringExecution\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"nodeSelectorTerms\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"matchExpressions\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n          \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"key\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\" fluid.io/s\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\"default\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\"hbase\\n            \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"operator\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\" In\\n            \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[a._v(\"values\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n            \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"-\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v('\"true\"')]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"正如亲和性所影响的，Pod会强制调度到了有缓存的node.172.16.0.16节点。\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-shell extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[s(\"code\",[a._v(\"$ kubectl get pods nginx -o  custom-columns\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"NAME:metadata.name,NODE:.spec.nodeName\\nNAME    NODE\\nnginx   node.172.16.0.16\\n\")])])]),s(\"blockquote\",[s(\"p\",[a._v(\"注释： K8s默认调度器并不需要配置强制亲和性，但是如果使用一些类似Volcano，Yunikorn等调度器组件并不感知K8s原生数据卷的亲和性，导致应用调度\")])])])}),[],!1,null,null,null);t.default=e.exports}}]);","extractedComments":[]}