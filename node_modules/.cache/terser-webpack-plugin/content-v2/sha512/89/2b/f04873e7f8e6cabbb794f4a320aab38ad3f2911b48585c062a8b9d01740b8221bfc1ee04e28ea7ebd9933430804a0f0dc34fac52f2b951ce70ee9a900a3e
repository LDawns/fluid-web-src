{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{483:function(t,a,s){\"use strict\";s.r(a);var e=s(50),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"example-using-fluid-to-access-non-root-user-s-data\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#example-using-fluid-to-access-non-root-user-s-data\"}},[t._v(\"#\")]),t._v(\" Example - Using Fluid to access non-root user's data\")]),t._v(\" \"),s(\"p\",[t._v(\"If the user data could only be access by specific uid, Runtime's 'RunAs' parameter should be set to let specific user run distributed data caching engine, to access underlying data.\")]),t._v(\" \"),s(\"p\",[t._v(\"This document demonstrates the above features with a simple example.\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"prerequisites\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\"}},[t._v(\"#\")]),t._v(\" Prerequisites\")]),t._v(\" \"),s(\"ul\",[s(\"li\",[s(\"a\",{attrs:{href:\"https://github.com/fluid-cloudnative/fluid\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Fluid\"),s(\"OutboundLink\")],1),t._v(\"(version >= 0.3.0)\")])]),t._v(\" \"),s(\"p\",[t._v(\"Please refer to \"),s(\"a\",{attrs:{href:\"https://github.com/fluid-cloudnative/fluid/blob/master/docs/zh/userguide/install.md\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Fluid installation documentation\"),s(\"OutboundLink\")],1),t._v(\" to complete installation.\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"running-example\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#running-example\"}},[t._v(\"#\")]),t._v(\" Running Example\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"Create a non-root user\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ groupadd -g 1201 fluid-user-1 && \\\\\\nuseradd -u 1201 -g fluid-user-1 fluid-user-1\\n\")])])]),s(\"p\",[t._v(\"The above command creates a non-root user\"),s(\"code\",[t._v(\"fluid-user-1\")])]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"Create a directory that belongs to the user\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v('$ mkdir -p /mnt/nonroot/user1_data && \\\\\\necho \"This is fluid-user-1\\'s data\" > /mnt/nonroot/user1_data/data1 && \\\\\\nchown -R fluid-user-1:fluid-user-1 /mnt/nonroot/user1_data && \\\\\\nchmod -R 0750 /mnt/nonroot/user1_data\\n')])])]),s(\"p\",[t._v(\"The above command creates a directory \"),s(\"code\",[t._v(\"user1_data\")]),t._v(\" belonging to \"),s(\"code\",[t._v(\"fluid-user-1\")]),t._v(\" in the \"),s(\"code\",[t._v(\"/mnt/nonroot\")]),t._v(\" directory, We will use the \"),s(\"code\",[t._v(\"data1\")]),t._v(\" file in the \"),s(\"code\",[t._v(\"user1_data\")]),t._v(\" directory to represent the data owned by \"),s(\"code\",[t._v(\"fluid-user-1\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ ls -ltR /mnt/nonroot\\n\")])])]),s(\"p\",[t._v(\"Using the above command, you will see the following results\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"/mnt/nonroot/:\\ntotal 4\\ndrwxr-x--- 2 fluid-user-1 fluid-user-1 4096 9月  27 16:45 user1_data\\n\\n/mnt/nonroot/user1_data:\\ntotal 4\\n-rwxr-x--- 1 fluid-user-1 fluid-user-1 28 9月  27 16:45 data1\\n\")])])]),s(\"p\",[s(\"strong\",[t._v(\"Create Dataset and AlluxioRuntime resource object\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language-yaml extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-yaml\"}},[s(\"code\",[t._v(\"$ cat<<EOF \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\">\")]),t._v(\"dataset.yaml\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"apiVersion\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" data.fluid.io/v1alpha1\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"kind\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" Dataset\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"metadata\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" nonroot\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spec\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"mounts\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# Specify the directory you just created as the mount point\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"mountPoint\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" local\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"///mnt/nonroot/\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" nonroot\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# Ensure that the data cache is placed at the node where the /mnt/nonroot directory exists\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"nodeAffinity\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"required\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"nodeSelectorTerms\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"matchExpressions\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n            \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"key\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" nonroot\\n              \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"operator\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" In\\n              \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"values\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n                \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"true\"')]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"---\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"apiVersion\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" data.fluid.io/v1alpha1\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"kind\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" AlluxioRuntime\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"metadata\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"name\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" nonroot\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"spec\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"replicas\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"tieredstore\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"levels\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n      \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"mediumtype\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" SSD\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"path\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" /var/lib/docker/alluxio\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"quota\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" 2Gi\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"high\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"0.95\"')]),t._v(\"\\n        \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"low\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"0.7\"')]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"# start Alluxio as the fluid-user-1 user\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"runAs\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"uid\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1201\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"gid\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1201\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"user\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" fluid\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"user\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"group\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" fluid\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"user\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"fuse\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[t._v(\"args\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" fuse\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"fuse\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"-\")]),t._v(\"opts=kernel_cache\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"ro\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"max_read=131072\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"attr_timeout=7200\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"entry_timeout=7200\"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"max_readahead=0\\nEOF\\n\")])])]),s(\"p\",[t._v(\"In the above yaml configuration file, we will mount the directory we just created (/mnt/nonroot ') in the same way as the Fluid host directory. For more information about Fluid mount host directory, please refer to \"),s(\"RouterLink\",{attrs:{to:\"/samples/hostpath.html\"}},[t._v(\"example - use Fluid to accelerate host directory\")])],1),t._v(\" \"),s(\"p\",[t._v(\"In addition, in \"),s(\"code\",[t._v(\"spec.runAs\")]),t._v(\" we have set user information such as \"),s(\"code\",[t._v(\"uid\")]),t._v(\", which means that we are going to start the caching engine as a \"),s(\"code\",[t._v(\"fluid-user-1\")]),t._v(\" user to provide distributed caching capabilities\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"Log into the Application\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ kubectl exec -it nginx -- bash\\n\")])])]),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ id\\n\")])])]),s(\"p\",[t._v(\"Using the above command, you will see the following results:\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"uid=1201 gid=1201 groups=1201\\n\")])])]),s(\"p\",[t._v(\"This indicates that we started the application as a user with \"),s(\"code\",[t._v(\"uid\")]),t._v(\" of 1201\")]),t._v(\" \"),s(\"p\",[s(\"strong\",[t._v(\"Access Data\")])]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ ls -ltR /data\\n\")])])]),s(\"p\",[t._v(\"Using the above command, you will see the following results:\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"/data/:\\ntotal 1\\ndrwxr-xr-x 1 root root 1 Sep 27 08:45 nonroot\\n\\n/data/nonroot:\\ntotal 1\\ndrwxr-x--- 1 1201 1201 1 Sep 27 08:45 user1_data\\n\\n/data/nonroot/user1_data:\\ntotal 1\\n-rwxr-x--- 1 1201 1201 28 Sep 27 08:45 data1\\n\")])])]),s(\"p\",[t._v(\"As you can see, Fluid exposes data belonging to a non-root user to applications that require it in the manner of \"),s(\"strong\",[t._v(\"passthrough\")]),t._v(\", and the file information for the user's data does not change\")]),t._v(\" \"),s(\"p\",[t._v(\"Of course, the user is free to access the data:\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ cat /data/nonroot/user1_data/data1\\n\")])])]),s(\"p\",[t._v(\"Using the above command, you will see the following results:\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"This is fluid-user-1's data\\n\")])])]),s(\"h2\",{attrs:{id:\"environment-cleanup\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#environment-cleanup\"}},[t._v(\"#\")]),t._v(\" Environment Cleanup\")]),t._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[t._v(\"$ kubectl delete -f .\\n$ rm -rf /mnt/nonroot\\n$ userdel fluid-user-1\\n\")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);","extractedComments":[]}