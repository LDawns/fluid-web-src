{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{513:function(a,t,s){\"use strict\";s.r(t);var e=s(50),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":a.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"示例-使用fluid加速pvc\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#示例-使用fluid加速pvc\"}},[a._v(\"#\")]),a._v(\" 示例 - 使用Fluid加速PVC\")]),a._v(\" \"),s(\"p\",[s(\"a\",{attrs:{href:\"http://tbm-auth.alicdn.com/e99361edd833010b/dSVC55aoHBRio4co9aD/SbYHTqH0w2wGIInlxsZ_281779782703_hd_hq.mp4?auth_key=1627029354-0-0-14a80599733d6f0ce6dbcc882f7a4509\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s(\"img\",{attrs:{src:\"https://fluid-imgs.oss-cn-shanghai.aliyuncs.com/public/imgs/accelerate_pvc.jfif\",alt:\"pvc_demo\"}}),s(\"OutboundLink\")],1)]),a._v(\" \"),s(\"h2\",{attrs:{id:\"测试场景-resnet50-模型训练\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#测试场景-resnet50-模型训练\"}},[a._v(\"#\")]),a._v(\" 测试场景：ResNet50 模型训练\")]),a._v(\" \"),s(\"ul\",[s(\"li\",[a._v(\"测试机型： V100 x8\")]),a._v(\" \"),s(\"li\",[a._v(\"容量型nfs\")])]),a._v(\" \"),s(\"h2\",{attrs:{id:\"配置\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置\"}},[a._v(\"#\")]),a._v(\" 配置\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"硬件配置\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#硬件配置\"}},[a._v(\"#\")]),a._v(\" 硬件配置\")]),a._v(\" \"),s(\"table\",[s(\"thead\",[s(\"tr\",[s(\"th\",[a._v(\"Cluster\")]),a._v(\" \"),s(\"th\",[a._v(\"Alibaba Cloud Kubernetes. v1.16.9-aliyun.1\")])])]),a._v(\" \"),s(\"tbody\",[s(\"tr\",[s(\"td\",[a._v(\"ECS实例\")]),a._v(\" \"),s(\"td\",[a._v(\"ECS   规格：ecs.gn6v-c10g1.20xlarge\"),s(\"br\"),a._v(\"    CPU：82核\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"分布式存储\")]),a._v(\" \"),s(\"td\",[a._v(\"容量型NAS\")])])])]),a._v(\" \"),s(\"h3\",{attrs:{id:\"软件配置\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#软件配置\"}},[a._v(\"#\")]),a._v(\" 软件配置\")]),a._v(\" \"),s(\"p\",[a._v(\"软件版本： 0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6\")]),a._v(\" \"),s(\"h2\",{attrs:{id:\"前提条件\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#前提条件\"}},[a._v(\"#\")]),a._v(\" 前提条件\")]),a._v(\" \"),s(\"ul\",[s(\"li\",[s(\"a\",{attrs:{href:\"https://github.com/fluid-cloudnative/fluid\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a._v(\"Fluid\"),s(\"OutboundLink\")],1),a._v(\" (version >= 0.3.0)\")]),a._v(\" \"),s(\"li\",[s(\"a\",{attrs:{href:\"https://github.com/kubeflow/arena\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a._v(\"Arena\"),s(\"OutboundLink\")],1),a._v(\"（version >= 0.4.0）\")]),a._v(\" \"),s(\"li\",[s(\"a\",{attrs:{href:\"https://github.com/horovod/horovod\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a._v(\"Horovod\"),s(\"OutboundLink\")],1),a._v(\" (version=0.18.1)\")]),a._v(\" \"),s(\"li\",[s(\"a\",{attrs:{href:\"https://github.com/tensorflow/benchmarks/tree/cnn_tf_v1.14_compatible\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a._v(\"Benchmark\"),s(\"OutboundLink\")],1)])]),a._v(\" \"),s(\"h2\",{attrs:{id:\"数据准备\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#数据准备\"}},[a._v(\"#\")]),a._v(\" 数据准备\")]),a._v(\" \"),s(\"ol\",[s(\"li\",[a._v(\"下载数据集\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[a._v(\"wget\")]),a._v(\" http://imagenet-tar.oss-cn-shanghai.aliyuncs.com/imagenet.tar.gz\\n\")])])]),s(\"ol\",{attrs:{start:\"2\"}},[s(\"li\",[a._v(\"解压数据集\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[a._v(\"tar\")]),a._v(\" -I pigz -xvf imagenet.tar.gz\\n\")])])]),s(\"h2\",{attrs:{id:\"nfs-dawnbench测试\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nfs-dawnbench测试\"}},[a._v(\"#\")]),a._v(\" NFS dawnbench测试\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"部署数据集\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#部署数据集\"}},[a._v(\"#\")]),a._v(\" 部署数据集\")]),a._v(\" \"),s(\"ol\",[s(\"li\",[s(\"p\",[a._v(\"在NFS Server中挂载数据集\")])]),a._v(\" \"),s(\"li\",[s(\"p\",[a._v(\"使用Kubernetes创建nfs的volume\")])])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[a._v(\"cat\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<<\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v(\"EOF\"),s(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\" nfs.yaml\")]),a._v(\"\\napiVersion: v1\\nkind: PersistentVolume\\nmetadata:\\n  name: nfs-imagenet\\nspec:\\n  capacity:\\n    storage: 150Gi\\n  volumeMode: Filesystem\\n  accessModes:\\n  - ReadOnlyMany\\n  persistentVolumeReclaimPolicy: Retain\\n  storageClassName: nfs\\n  mountOptions:\\n  - vers=3\\n  - nolock\\n  - proto=tcp\\n  - rsize=1048576\\n  - wsize=1048576\\n  - hard\\n  - timeo=600\\n  - retrans=2\\n  - noresvport\\n  - nfsvers=4.1\\n  nfs:\\n    path: <YOUR_PATH_TO_DATASET>\\n    server: <YOUR_NFS_SERVER>\\n---\\napiVersion: v1\\nkind: PersistentVolumeClaim\\nmetadata:\\n  name: nfs-imagenet\\nspec:\\n  accessModes:\\n  - ReadOnlyMany\\n  resources:\\n    requests:\\n      storage: 150Gi\\n  storageClassName: nfs\\nEOF\")]),a._v(\"\\n\")])])]),s(\"blockquote\",[s(\"p\",[s(\"strong\",[a._v(\"NOTE:\")])]),a._v(\" \"),s(\"p\",[a._v(\"修改上述yaml文件中的nfs的server和path为您的nfs server地址和挂载路径。\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ kubectl create -f nfs.yaml\\n\")])])]),s(\"ol\",{attrs:{start:\"3\"}},[s(\"li\",[a._v(\"检查Kubernetes是否正常创建volume\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ kubectl get pv,pvc\\nNAME                            CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS   REASON   AGE\\npersistentvolume/nfs-imagenet   150Gi      ROX            Retain           Bound    default/nfs-imagenet   nfs                     45s\\n\\nNAME                                 STATUS   VOLUME         CAPACITY   ACCESS MODES   STORAGECLASS   AGE\\npersistentvolumeclaim/nfs-imagenet   Bound    nfs-imagenet   150Gi      ROX            nfs            45s\\n\")])])]),s(\"h3\",{attrs:{id:\"dawnbench\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#dawnbench\"}},[a._v(\"#\")]),a._v(\" dawnbench\")]),a._v(\" \"),s(\"h4\",{attrs:{id:\"单机八卡\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#单机八卡\"}},[a._v(\"#\")]),a._v(\" 单机八卡\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"arena submit mpi \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --name horovod-resnet50-v2-1x8-nfs \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --gpus\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --workers\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --working-dir\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/horovod-demo/tensorflow-demo/ \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --data nfs-imagenet:/data \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"DATA_DIR\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/data/imagenet \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"num_batch\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1000\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"datasets_num_private_threads\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --image\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    ./launch-example.sh \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\"\\n\")])])]),s(\"h4\",{attrs:{id:\"四机八卡\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#四机八卡\"}},[a._v(\"#\")]),a._v(\" 四机八卡\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"arena submit mpi \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --name horovod-resnet50-v2-4x8-nfs \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --gpus\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --workers\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"4\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --working-dir\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/horovod-demo/tensorflow-demo/ \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --data nfs-imagenet:/data \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"DATA_DIR\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/data/imagenet \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"num_batch\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1000\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"datasets_num_private_threads\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --image\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    ./launch-example.sh \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"4\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\"\\n\")])])]),s(\"blockquote\",[s(\"p\",[s(\"strong\",[a._v(\"NOTE:\")])]),a._v(\" \"),s(\"p\",[a._v(\"训练完成后，arena保留了laucher，可能导致nfs删不掉。请在提交nfs删除命令后执行如下命令：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ kubectl patch pvc nfs-imagenet  -p \"),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v('\\'{\"metadata\":{\"finalizers\": []}}\\'')]),a._v(\" --type\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"merge\\n\")])])])]),a._v(\" \"),s(\"h2\",{attrs:{id:\"fluid加速pvc\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fluid加速pvc\"}},[a._v(\"#\")]),a._v(\" Fluid加速PVC\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"部署数据集-2\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#部署数据集-2\"}},[a._v(\"#\")]),a._v(\" 部署数据集\")]),a._v(\" \"),s(\"ol\",[s(\"li\",[a._v(\"按照前述步骤创建NFS的volume\")]),a._v(\" \"),s(\"li\",[a._v(\"部署Fluid加速刚才创建的PVC\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ \"),s(\"span\",{pre:!0,attrs:{class:\"token function\"}},[a._v(\"cat\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"<<\")]),s(\"span\",{pre:!0,attrs:{class:\"token string\"}},[a._v(\"EOF\"),s(\"span\",{pre:!0,attrs:{class:\"token bash punctuation\"}},[a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\" dataset.yaml\")]),a._v('\\napiVersion: data.fluid.io/v1alpha1\\nkind: Dataset\\nmetadata:\\n  name: fluid-imagenet\\nspec:\\n  mounts:\\n  - mountPoint: pvc://nfs-imagenet\\n    name: nfs-imagenet\\n  nodeAffinity:\\n    required:\\n      nodeSelectorTerms:\\n        - matchExpressions:\\n            - key: aliyun.accelerator/nvidia_name\\n              operator: In\\n              values:\\n                - Tesla-V100-SXM2-16GB\\n---\\napiVersion: data.fluid.io/v1alpha1\\nkind: AlluxioRuntime\\nmetadata:\\n  name: fluid-imagenet\\nspec:\\n  replicas: 4\\n  data:\\n    replicas: 1\\n  tieredstore:\\n    levels:\\n      - mediumtype: SSD\\n        path: /var/lib/docker/alluxio\\n        quota: 150Gi\\n        high: \"0.99\"\\n        low: \"0.8\"\\nEOF')]),a._v(\"\\n\")])])]),s(\"blockquote\",[s(\"p\",[s(\"strong\",[a._v(\"NOTE:\")])]),a._v(\" \"),s(\"ul\",[s(\"li\",[s(\"code\",[a._v(\"spec.replicas\")]),a._v(\"和dawnbench测试的worker数量保持一致。比如：单机八卡为1，四机八卡为4。\")]),a._v(\" \"),s(\"li\",[s(\"code\",[a._v(\"nodeSelectorTerms\")]),a._v(\"作用是限制在有V100显卡的机器上部署数据集，此处应根据实验环境具体调节。\")])])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ kubectl create -f dataset.yaml\\n\")])])]),s(\"ol\",{attrs:{start:\"3\"}},[s(\"li\",[a._v(\"检查部署\")])]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"$ kubectl get pv,pvc\\nNAME                              CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS   REASON   AGE\\npersistentvolume/fluid-imagenet   100Gi      RWX            Retain           Bound    default/fluid-imagenet                           1s\\npersistentvolume/nfs-imagenet     150Gi      ROX            Retain           Bound    default/nfs-imagenet     nfs                     16m\\n\\nNAME                                   STATUS   VOLUME           CAPACITY   ACCESS MODES   STORAGECLASS   AGE\\npersistentvolumeclaim/fluid-imagenet   Bound    fluid-imagenet   100Gi      RWX                           0s\\npersistentvolumeclaim/nfs-imagenet     Bound    nfs-imagenet     150Gi      ROX            nfs            16m\\n\")])])]),s(\"h3\",{attrs:{id:\"dawnbench-2\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#dawnbench-2\"}},[a._v(\"#\")]),a._v(\" dawnbench\")]),a._v(\" \"),s(\"h4\",{attrs:{id:\"单机八卡-2\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#单机八卡-2\"}},[a._v(\"#\")]),a._v(\" 单机八卡\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"arena submit mpi \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --name horovod-resnet50-v2-1x8-fluid \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --gpus\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --workers\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --working-dir\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/horovod-demo/tensorflow-demo/ \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --data fluid-imagenet:/data \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"DATA_DIR\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/data/nfs-imagenet/imagenet \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"num_batch\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1000\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"datasets_num_private_threads\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --image\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    ./launch-example.sh \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\"\\n\")])])]),s(\"h4\",{attrs:{id:\"四机八卡-2\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#四机八卡-2\"}},[a._v(\"#\")]),a._v(\" 四机八卡\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-bash extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[s(\"code\",[a._v(\"arena submit mpi \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --name horovod-resnet50-v2-4x8-fluid \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --gpus\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --workers\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"4\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --working-dir\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/horovod-demo/tensorflow-demo/ \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --data fluid-imagenet:/data \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"DATA_DIR\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"/data/nfs-imagenet/imagenet \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"num_batch\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"1000\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    -e \"),s(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[a._v(\"datasets_num_private_threads\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    --image\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[a._v(\"=\")]),a._v(\"registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \"),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[a._v(\"\\\\\")]),a._v(\"\\n    ./launch-example.sh \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"4\")]),a._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[a._v(\"8\")]),a._v(\"\\n\")])])]),s(\"h2\",{attrs:{id:\"测试结果\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#测试结果\"}},[a._v(\"#\")]),a._v(\" 测试结果\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"horovod-1x8\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#horovod-1x8\"}},[a._v(\"#\")]),a._v(\" horovod-1x8\")]),a._v(\" \"),s(\"table\",[s(\"thead\",[s(\"tr\",[s(\"th\"),a._v(\" \"),s(\"th\",[a._v(\"nfs\")]),a._v(\" \"),s(\"th\",[a._v(\"fluid (cold)\")]),a._v(\" \"),s(\"th\",[a._v(\"fluid (warm)\")])])]),a._v(\" \"),s(\"tbody\",[s(\"tr\",[s(\"td\",[a._v(\"训练时间\")]),a._v(\" \"),s(\"td\",[a._v(\"3h49m10s\")]),a._v(\" \"),s(\"td\",[a._v(\"3h50m40s\")]),a._v(\" \"),s(\"td\",[a._v(\"3h34m15s\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"1000步速度(images/second)\")]),a._v(\" \"),s(\"td\",[a._v(\"2400.8\")]),a._v(\" \"),s(\"td\",[a._v(\"2378.4\")]),a._v(\" \"),s(\"td\",[a._v(\"9327.6\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"最终速度(images/second)\")]),a._v(\" \"),s(\"td\",[a._v(\"8696.8\")]),a._v(\" \"),s(\"td\",[a._v(\"8692.8\")]),a._v(\" \"),s(\"td\",[a._v(\"9301.6\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"steps\")]),a._v(\" \"),s(\"td\",[a._v(\"56300\")]),a._v(\" \"),s(\"td\",[a._v(\"56300\")]),a._v(\" \"),s(\"td\",[a._v(\"56300\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"Accuracy @ 5\")]),a._v(\" \"),s(\"td\",[a._v(\"0.9282\")]),a._v(\" \"),s(\"td\",[a._v(\"0.9286\")]),a._v(\" \"),s(\"td\",[a._v(\"0.9285\")])])])]),a._v(\" \"),s(\"h3\",{attrs:{id:\"horovod-4x8\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#horovod-4x8\"}},[a._v(\"#\")]),a._v(\" horovod-4x8\")]),a._v(\" \"),s(\"table\",[s(\"thead\",[s(\"tr\",[s(\"th\"),a._v(\" \"),s(\"th\",[a._v(\"nfs\")]),a._v(\" \"),s(\"th\",[a._v(\"fluid (cold)\")]),a._v(\" \"),s(\"th\",[a._v(\"fluid (warm)\")])])]),a._v(\" \"),s(\"tbody\",[s(\"tr\",[s(\"td\",[a._v(\"训练时间\")]),a._v(\" \"),s(\"td\",[a._v(\"2h15m59s\")]),a._v(\" \"),s(\"td\",[a._v(\"1h43m43s\")]),a._v(\" \"),s(\"td\",[a._v(\"1h32m22s\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"1000步速度(images/second)\")]),a._v(\" \"),s(\"td\",[a._v(\"3136\")]),a._v(\" \"),s(\"td\",[a._v(\"8889.6\")]),a._v(\" \"),s(\"td\",[a._v(\"20859.5\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"最终速度(images/second)\")]),a._v(\" \"),s(\"td\",[a._v(\"15024\")]),a._v(\" \"),s(\"td\",[a._v(\"20506.3\")]),a._v(\" \"),s(\"td\",[a._v(\"21329\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"steps\")]),a._v(\" \"),s(\"td\",[a._v(\"14070\")]),a._v(\" \"),s(\"td\",[a._v(\"14070\")]),a._v(\" \"),s(\"td\",[a._v(\"14070\")])]),a._v(\" \"),s(\"tr\",[s(\"td\",[a._v(\"Accuracy @ 5\")]),a._v(\" \"),s(\"td\",[a._v(\"0.9228\")]),a._v(\" \"),s(\"td\",[a._v(\"0.9204\")]),a._v(\" \"),s(\"td\",[a._v(\"0.9243\")])])])]),a._v(\" \"),s(\"h2\",{attrs:{id:\"结果分析\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#结果分析\"}},[a._v(\"#\")]),a._v(\" 结果分析\")]),a._v(\" \"),s(\"p\",[a._v(\"从测试结果来看，单机八卡通过Fluid加速效果并没有明显的效果，但是在四机八卡的场景下Fluid加速效果非常明显。在热数据的场景下，可以缩短训练时间 (135-92)/135 = 31 %; 在冷数据场景下可以缩短训练时间 （135-103）/135 = 23 % 。 这是由于四机八卡下，NFS的带宽成为了瓶颈；而Fluid基于Alluxio提供了分布式缓存的P2P数据读取能力。\")])])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}